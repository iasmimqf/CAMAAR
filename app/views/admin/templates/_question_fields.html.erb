<%# app/views/templates/_question_fields.html.erb %>
<div class="nested-fields card mb-3">
  <div class="card-body">
    <%= link_to_remove_association "Remover", f, class: "btn btn-danger btn-sm float-end" %>

    <div class="mb-3">
      <%= f.label :question_type, "Tipo de Questão", class: "form-label" %>
      <%= f.select :question_type,
        options_for_select(
          [
            ['Escala (1-5)', 'scale'],
            ['Texto Livre', 'text']
          ],
          f.object.question_type
        ),
        { prompt: "Selecione o tipo" },
        class: "form-select question-type",
        required: true
      %>
    </div>

    <div class="mb-3">
      <%= f.label :prompt, "Enunciado", class: "form-label" %>
      <%= f.text_area :prompt, class: "form-control", required: true %>
    </div>

    <div class="mb-3 form-check">
      <%= f.check_box :mandatory, class: "form-check-input" %>
      <%= f.label :mandatory, "Obrigatória?", class: "form-check-label" %>
    </div>

    <div class="mb-3 options-field" style="<%= f.object.question_type == 'scale' ? '' : 'display: none;' %>">
      <%= f.label :options, "Opções (separadas por vírgula)", class: "form-label" %>
      <%= f.text_field :options,
            class: "form-control",
            placeholder: "Ex: 5,4,3,2,1",
            value: f.object.options || "5,4,3,2,1" %>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    $('.question-type').change(function() {
      const optionsField = $(this).closest('.nested-fields').find('.options-field');
      if ($(this).val() === 'scale') {
        optionsField.show();
      } else {
        optionsField.hide();
      }
    });
  });
</script>